<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Calendar Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* í°íŠ¸ ë° ë¦¬ì…‹ */
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: #e9ecef; 
            display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        
        /* 1. ì•± ì»¨í…Œì´ë„ˆ (ì‚¬ì´ì¦ˆ ì¶•ì†Œ ë° ìµœì í™”) */
        .app-container {
            width: 100%; max-width: 375px; /* í­ì„ ì•½ê°„ ì¤„ì„ */
            height: 100vh; max-height: 800px; /* ë†’ì´ ì œí•œ */
            background-color: #F8F9FA; 
            border-radius: 20px; /* ë¼ìš´ë“œ ì•½ê°„ ì¤„ì„ */
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            overflow: hidden; display: flex; flex-direction: column; position: relative;
        }

        /* í—¤ë” */
        header { padding: 20px 20px 10px 20px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .header-title { font-size: 20px; font-weight: 800; color: #111; }
        .header-icons i { font-size: 18px; margin-left: 15px; color: #333; cursor: pointer; }

        /* ì›” ì»¨íŠ¸ë¡¤ */
        .month-control { padding: 5px 20px 15px 20px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .date-nav { display: flex; align-items: center; gap: 12px; font-size: 17px; font-weight: 700; color: #111; }
        .nav-btn { cursor: pointer; padding: 8px; color: #555; transition: 0.2s; }
        .nav-btn:hover { background: rgba(0,0,0,0.05); border-radius: 50%; }
        
        .today-btn { 
            border: 1px solid #333; border-radius: 6px; 
            padding: 4px 8px; font-size: 11px; font-weight: 700; cursor: pointer; 
        }

        /* ìš”ì¼ í—¤ë” */
        .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; padding: 0 12px 8px 12px; flex-shrink: 0; }
        .weekday { font-size: 12px; color: #888; font-weight: 500; }
        .weekday.sun { color: #FF6B6B; }
        .weekday.sat { color: #333; }

        /* ìº˜ë¦°ë” ì˜ì—­ (ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ ë˜í¼) */
        .calendar-wrapper {
            position: relative;
            flex-shrink: 0;
            height: 340px; /* ë‹¬ë ¥ ì˜ì—­ ë†’ì´ ê³ ì • */
            overflow: hidden;
            width: 100%;
        }

        .calendar-grid { 
            display: grid; grid-template-columns: repeat(7, 1fr); 
            padding: 0 12px; row-gap: 4px;
            position: absolute; top: 0; left: 0; width: 100%;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        
        /* ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ */
        .calendar-grid.slide-next-enter { transform: translateX(100%); opacity: 0; }
        .calendar-grid.slide-next-active { transform: translateX(0); opacity: 1; }
        .calendar-grid.slide-next-leave { transform: translateX(-100%); opacity: 0; }

        .calendar-grid.slide-prev-enter { transform: translateX(-100%); opacity: 0; }
        .calendar-grid.slide-prev-active { transform: translateX(0); opacity: 1; }
        .calendar-grid.slide-prev-leave { transform: translateX(100%); opacity: 0; }


        /* ë‚ ì§œ ì…€ ìŠ¤íƒ€ì¼ (ì‚¬ì´ì¦ˆ ì¶•ì†Œ) */
        .day-cell { 
            display: flex; flex-direction: column; align-items: center; 
            height: 52px; /* ì…€ ë†’ì´ ì¶•ì†Œ */
            cursor: pointer; position: relative; border-radius: 6px; 
        }
        
        .day-number { 
            width: 26px; height: 26px; margin-top: 2px;
            display: flex; justify-content: center; align-items: center; 
            border-radius: 8px; font-size: 14px; font-weight: 600; color: #333; 
            z-index: 2;
        }

        /* ìƒ‰ìƒ ë¡œì§ */
        .day-cell.sun .day-number, .day-cell.holiday .day-number { color: #FF6B6B; }
        .day-cell.sat .day-number { color: #333; }
        .day-cell.prev-month .day-number, .day-cell.next-month .day-number { color: #ddd !important; opacity: 0.5; }

        /* ì„ íƒ/ì˜¤ëŠ˜ ë””ìì¸ */
        .day-cell.is-today .day-number { background-color: #111; color: white !important; }
        .day-cell.is-selected:not(.is-today) .day-number { border: 1.5px solid #111; color: #111 !important; }
        .day-cell.is-selected:not(.is-today).holiday .day-number { color: #FF6B6B !important; border-color: #111; }

        /* ì´ë²¤íŠ¸ ë  */
        .event-labels { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 1px; margin-top: 1px; }
        .event-pill { width: 80%; height: 4px; border-radius: 2px; }
        .event-pill.text-pill { height: auto; padding: 1px 3px; font-size: 8px; line-height: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #333; text-align: center; }

        /* ì¼ì • ë¦¬ìŠ¤íŠ¸ (ìŠ¤í¬ë¡¤ ì˜ì—­) */
        .schedule-list { 
            flex: 1; padding: 20px 24px 80px 24px; /* í•˜ë‹¨ íŒ¨ë”© í™•ë³´ */
            border-top: 1px solid #eee; margin-top: 5px; 
            overflow-y: auto; background: white; border-radius: 20px 20px 0 0;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.02);
        }
        .schedule-header { font-size: 15px; font-weight: 700; color: #111; margin-bottom: 15px; }
        
        .schedule-item { display: flex; align-items: center; margin-bottom: 12px; }
        .schedule-color-bar { width: 3px; height: 32px; border-radius: 3px; margin-right: 12px; }
        .schedule-info { display: flex; flex-direction: column; justify-content: center; }
        .schedule-title { font-size: 14px; font-weight: 600; color: #222; }
        .schedule-time { font-size: 11px; color: #999; margin-top: 2px; }
        .empty-message { text-align: center; color: #aaa; font-size: 13px; margin-top: 40px; }

        /* í”Œë¡œíŒ… ë²„íŠ¼ */
        .bottom-bar { position: absolute; bottom: 20px; left: 0; right: 0; padding: 0 20px; z-index: 10; pointer-events: none; }
        .floating-btn {
            pointer-events: auto;
            background: white; height: 50px; border-radius: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; cursor: pointer; 
            transition: transform 0.2s;
        }
        .floating-btn:active { transform: scale(0.96); }
        .fb-text { color: #555; font-size: 13px; font-weight: 500; }
        .fb-icon { font-size: 18px; color: #333; }

        /* ====================
           ëª¨ë‹¬ (ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜ ìˆ˜ì •)
           ==================== */
        .add-event-modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #fff; z-index: 999;
            display: flex; flex-direction: column;
            transform: translateX(100%); /* ê¸°ë³¸ ìˆ¨ê¹€ */
            transition: transform 0.3s cubic-bezier(0.33, 1, 0.68, 1); /* ë¶€ë“œëŸ¬ìš´ ê°ì† */
            visibility: hidden; /* ì™„ì „íˆ ìˆ¨ê¹€ */
        }

        .add-event-modal.open { transform: translateX(0); visibility: visible; }

        .modal-header { padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #f0f0f0; }
        .back-btn { font-size: 18px; padding: 10px; cursor: pointer; margin-right: 5px; }
        .modal-title-text { font-size: 16px; font-weight: 700; }

        .form-content { flex: 1; padding: 20px; overflow-y: auto; }
        
        .title-input { width: 100%; border: none; border-bottom: 1px solid #ccc; font-size: 18px; padding: 8px 0; outline: none; background: transparent; border-radius: 0; margin-bottom: 25px; }
        .title-input:focus { border-bottom: 2px solid #111; }

        /* í•˜ë£¨ ì¢…ì¼ í† ê¸€ */
        .form-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .form-label { display: flex; align-items: center; gap: 10px; font-size: 14px; color: #333; font-weight: 500; }
        
        .toggle { width: 40px; height: 22px; background: #ddd; border-radius: 20px; position: relative; cursor: pointer; transition: 0.3s; }
        .toggle::after { content: ''; position: absolute; top: 2px; left: 2px; width: 18px; height: 18px; background: white; border-radius: 50%; transition: 0.3s; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .toggle.active { background: #5C6BC0; }
        .toggle.active::after { left: 20px; }

        /* ì‹œê°„ ì„¤ì • ì˜ì—­ (ë¹„í™œì„±í™” ìŠ¤íƒ€ì¼ í¬í•¨) */
        .time-picker-area {
            transition: opacity 0.3s;
            margin-bottom: 25px;
            background: #fdfdfd;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #f0f0f0;
        }
        .time-picker-area.disabled {
            opacity: 0.4;
            pointer-events: none; /* í´ë¦­ ë°©ì§€ */
            filter: grayscale(1);
        }

        .time-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .time-row:last-child { margin-bottom: 0; }
        .time-label { font-size: 13px; color: #666; width: 40px; }
        
        /* ë„¤ì´í‹°ë¸Œ ë‚ ì§œ/ì‹œê°„ ì¸í’‹ ìŠ¤íƒ€ì¼ë§ */
        .custom-datetime {
            border: 1px solid #e0e0e0; background: white; border-radius: 6px;
            padding: 6px 10px; font-size: 13px; color: #333;
            outline: none; font-family: 'Pretendard', sans-serif;
            flex: 1; margin-left: 10px;
        }

        /* ê¸°íƒ€ ì„¤ì • (ì•Œë¦¼ ë“±) */
        .detail-item { display: flex; align-items: center; padding: 14px 0; border-bottom: 1px solid #f5f5f5; }
        .detail-item i { width: 28px; color: #888; font-size: 15px; text-align: center; margin-right: 10px; }
        
        /* ì•Œë¦¼ ì„ íƒ Select */
        .custom-select {
            flex: 1; border: none; outline: none; background: transparent;
            font-size: 14px; color: #333; width: 100%;
            -webkit-appearance: none; /* í™”ì‚´í‘œ ìˆ¨ê¹€ */
        }
        .detail-input { flex: 1; border: none; outline: none; font-size: 14px; color: #333; background: transparent; }

        /* í•˜ë‹¨ ë²„íŠ¼ */
        .modal-footer { height: 60px; display: flex; border-top: 1px solid #eee; flex-shrink: 0; }
        .footer-btn { flex: 1; border: none; background: white; font-size: 15px; font-weight: 700; cursor: pointer; }
        .footer-btn:active { background: #f9f9f9; }
        .footer-btn.save { color: #5C6BC0; border-left: 1px solid #eee; }
        .footer-btn.cancel { color: #555; }

    </style>
</head>
<body>

    <div class="app-container">
        <header>
            <div class="header-title">ìº˜ë¦°ë”</div>
            <div class="header-icons">
                <i class="fa-solid fa-arrows-rotate" onclick="window.location.reload()"></i>
                <i class="fa-solid fa-gear"></i>
            </div>
        </header>

        <div class="month-control">
            <div class="date-nav">
                <i class="fa-solid fa-chevron-left nav-btn" onclick="slideMonth(-1)"></i>
                <span id="currentYearMonth"></span>
                <i class="fa-solid fa-chevron-right nav-btn" onclick="slideMonth(1)"></i>
            </div>
            <div class="today-btn" onclick="goToday()">ì˜¤ëŠ˜</div>
        </div>

        <div class="weekdays">
            <div class="weekday sun">ì¼</div>
            <div class="weekday">ì›”</div>
            <div class="weekday">í™”</div>
            <div class="weekday">ìˆ˜</div>
            <div class="weekday">ëª©</div>
            <div class="weekday">ê¸ˆ</div>
            <div class="weekday sat">í† </div>
        </div>

        <div class="calendar-wrapper" id="calendarWrapper">
            </div>

        <div class="schedule-list">
            <div class="schedule-header" id="scheduleHeader"></div>
            <div id="scheduleContainer"></div>
        </div>

        <div class="bottom-bar">
            <div class="floating-btn" onclick="openModal()">
                <span class="fb-text" id="floatingBtnText">ì¼ì • ì¶”ê°€</span>
                <i class="fa-solid fa-plus fb-icon"></i>
            </div>
        </div>

        <div class="add-event-modal" id="eventModal">
            <div class="modal-header">
                <i class="fa-solid fa-arrow-left back-btn" onclick="closeModal()"></i>
                <span class="modal-title-text">ìƒˆ ì¼ì •</span>
            </div>
            <div class="form-content">
                <input type="text" id="inputTitle" class="title-input" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                
                <div class="form-row">
                    <div class="form-label"><i class="fa-regular fa-clock"></i> í•˜ë£¨ ì¢…ì¼</div>
                    <div class="toggle" id="allDayToggle" onclick="toggleAllDay()"></div>
                </div>

                <div class="time-picker-area" id="timePickerArea">
                    <div class="time-row">
                        <span class="time-label">ì‹œì‘</span>
                        <input type="datetime-local" id="startTimeInput" class="custom-datetime">
                    </div>
                    <div class="time-row">
                        <span class="time-label">ì¢…ë£Œ</span>
                        <input type="datetime-local" id="endTimeInput" class="custom-datetime">
                    </div>
                </div>

                <div class="detail-item">
                    <i class="fa-solid fa-location-dot"></i>
                    <input class="detail-input" placeholder="ì¥ì†Œ ì¶”ê°€">
                </div>
                
                <div class="detail-item">
                    <i class="fa-regular fa-bell"></i>
                    <select class="custom-select" id="alarmSelect">
                        <option value="none">ì•Œë¦¼ ì—†ìŒ</option>
                        <option value="0">ì •ê°</option>
                        <option value="1">1ë¶„ ì „</option>
                        <option value="5">5ë¶„ ì „</option>
                        <option value="10" selected>10ë¶„ ì „</option>
                        <option value="15">15ë¶„ ì „</option>
                        <option value="30">30ë¶„ ì „</option>
                        <option value="60">1ì‹œê°„ ì „</option>
                        <option value="custom">ì§ì ‘ ì„¤ì •...</option>
                    </select>
                </div>

                <div class="detail-item">
                    <i class="fa-regular fa-calendar"></i>
                    <input class="detail-input" value="ë‚´ ìº˜ë¦°ë”" readonly>
                </div>

                <div class="detail-item" style="border:none;">
                    <i class="fa-solid fa-align-left"></i>
                    <input class="detail-input" placeholder="ë©”ëª¨ ì¶”ê°€">
                </div>
            </div>
            <div class="modal-footer">
                <button class="footer-btn cancel" onclick="closeModal()">ì·¨ì†Œ</button>
                <button class="footer-btn save" onclick="saveEvent()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <script>
        // ================= ìƒíƒœ ë³€ìˆ˜ =================
        let currentDate = new Date(); 
        let selectedDate = new Date();
        let userEvents = JSON.parse(localStorage.getItem('myCalendarEventsPro')) || {};
        let isAnimating = false; // ì• ë‹ˆë©”ì´ì…˜ ì¤‘ ì¤‘ë³µ í´ë¦­ ë°©ì§€

        // í•œêµ­ ê³µíœ´ì¼ ë°ì´í„°
        const holidays = {
            fixed: {'01-01':'ì‹ ì •', '03-01':'ì‚¼ì¼ì ˆ', '05-05':'ì–´ë¦°ì´ë‚ ', '06-06':'í˜„ì¶©ì¼', '08-15':'ê´‘ë³µì ˆ', '10-03':'ê°œì²œì ˆ', '10-09':'í•œê¸€ë‚ ', '12-25':'ì„±íƒ„ì ˆ'},
            lunar: {'2026-02-16':'ì„¤ë‚ ', '2026-02-17':'ì„¤ë‚ ', '2026-02-18':'ì„¤ë‚ ', '2026-05-24':'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ', '2026-09-24':'ì¶”ì„', '2026-09-25':'ì¶”ì„', '2026-09-26':'ì¶”ì„'}
        };

        // ================= ì´ˆê¸°í™” ë° ë Œë”ë§ =================
        function init() {
            renderCurrentMonthGrid(document.getElementById('calendarWrapper'));
            updateHeader();
            updateScheduleList();
        }

        function updateHeader() {
            document.getElementById('currentYearMonth').innerText = `${currentDate.getFullYear()}ë…„ ${currentDate.getMonth() + 1}ì›”`;
        }

        // íŠ¹ì • ì—°/ì›”ì˜ HTML Grid ë¬¸ìì—´ ìƒì„± (DOM Element ì•„ë‹˜)
        function createGridElement(year, month) {
            const grid = document.createElement('div');
            grid.className = 'calendar-grid';

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const prevLastDate = new Date(year, month, 0).getDate();

            const days = [];
            // ì´ì „ ë‹¬
            for (let i = firstDay; i > 0; i--) {
                days.push({ day: prevLastDate - i + 1, type: 'prev', year: month===0?year-1:year, month: month===0?12:month });
            }
            // ì´ë²ˆ ë‹¬
            for (let i = 1; i <= lastDate; i++) {
                days.push({ day: i, type: 'current', year: year, month: month+1 });
            }
            // ë‹¤ìŒ ë‹¬ (42ì¹¸ ì±„ìš°ê¸°)
            while (days.length < 42) {
                const d = days.length - (firstDay + lastDate) + 1;
                days.push({ day: d, type: 'next', year: month===11?year+1:year, month: month===11?1:month+2 });
            }

            days.forEach((d, idx) => {
                const cell = document.createElement('div');
                cell.className = 'day-cell';
                
                // í´ë˜ìŠ¤ ë¶€ì—¬
                if (d.type !== 'current') cell.classList.add(d.type === 'prev' ? 'prev-month' : 'next-month');
                if (idx % 7 === 0) cell.classList.add('sun');
                if (idx % 7 === 6) cell.classList.add('sat');

                // ê³µíœ´ì¼
                const dateKey = `${d.year}-${String(d.month).padStart(2,'0')}-${String(d.day).padStart(2,'0')}`;
                const mdKey = `${String(d.month).padStart(2,'0')}-${String(d.day).padStart(2,'0')}`;
                const holidayName = holidays.fixed[mdKey] || holidays.lunar[dateKey];
                if (holidayName) cell.classList.add('holiday');

                // ì„ íƒ/ì˜¤ëŠ˜ í™•ì¸
                const today = new Date();
                if (d.year === today.getFullYear() && d.month-1 === today.getMonth() && d.day === today.getDate()) cell.classList.add('is-today');
                if (d.year === selectedDate.getFullYear() && d.month-1 === selectedDate.getMonth() && d.day === selectedDate.getDate()) cell.classList.add('is-selected');

                // HTML ë‚´ë¶€
                let html = `<div class="day-number">${d.day}</div><div class="event-labels">`;
                if(holidayName && d.type === 'current') html += `<div class="event-pill text-pill" style="background:#FFCDD2; color:#D32F2F;">${holidayName}</div>`;
                
                if(userEvents[dateKey]) {
                    userEvents[dateKey].forEach(evt => {
                        html += `<div class="event-pill text-pill" style="background:${evt.color}40; color:#111;">${evt.title}</div>`;
                    });
                }
                html += `</div>`;
                cell.innerHTML = html;

                // í´ë¦­ ì´ë²¤íŠ¸
                cell.addEventListener('click', () => {
                    selectedDate = new Date(d.year, d.month - 1, d.day);
                    if (d.type !== 'current') {
                        slideMonth(d.type === 'prev' ? -1 : 1);
                    } else {
                        // ê°™ì€ ë‹¬ ë‚´ í´ë¦­: ì „ì²´ ê°±ì‹  ëŒ€ì‹  í´ë˜ìŠ¤ë§Œ í† ê¸€í•˜ì—¬ ê¹œë¹¡ì„ ë°©ì§€ ê°€ëŠ¥í•˜ì§€ë§Œ, ì‹¬í”Œí•˜ê²Œ ì¬ë Œë”ë§
                        const wrapper = document.getElementById('calendarWrapper');
                        wrapper.innerHTML = ''; // ê¸°ì¡´ ê²ƒ ì œê±°
                        renderCurrentMonthGrid(wrapper); // ë‹¤ì‹œ ê·¸ë¦¼
                    }
                    updateScheduleList();
                });

                grid.appendChild(cell);
            });

            return grid;
        }

        // ë˜í¼ ì•ˆì— í˜„ì¬ ë‹¬ ê·¸ë¦¬ë“œ ë„£ê¸°
        function renderCurrentMonthGrid(wrapper) {
            const grid = createGridElement(currentDate.getFullYear(), currentDate.getMonth());
            grid.classList.add('slide-next-active'); // ìœ„ì¹˜ ê³ ì •
            wrapper.appendChild(grid);
        }

        // ================= ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜ ë¡œì§ =================
        function slideMonth(direction) {
            if (isAnimating) return;
            isAnimating = true;

            const wrapper = document.getElementById('calendarWrapper');
            const currentGrid = wrapper.querySelector('.calendar-grid'); // í˜„ì¬ ë³´ì´ëŠ” ê·¸ë¦¬ë“œ

            // ë‚ ì§œ ë³€ê²½
            const prevDate = new Date(currentDate);
            currentDate.setMonth(currentDate.getMonth() + direction);
            updateHeader();

            // ìƒˆë¡œìš´ ê·¸ë¦¬ë“œ ìƒì„± (í™”ë©´ ë°–ì—ì„œ ëŒ€ê¸°)
            const newGrid = createGridElement(currentDate.getFullYear(), currentDate.getMonth());
            
            if (direction === 1) {
                // ë‹¤ìŒë‹¬: ì˜¤ë¥¸ìª½ì—ì„œ ë“¤ì–´ì˜´
                newGrid.classList.add('slide-next-enter');
                wrapper.appendChild(newGrid);
                
                // ê°•ì œ ë¦¬í”Œë¡œìš° (ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±°)
                void newGrid.offsetWidth; 

                // ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
                currentGrid.classList.remove('slide-next-active');
                currentGrid.classList.add('slide-next-leave');
                
                newGrid.classList.remove('slide-next-enter');
                newGrid.classList.add('slide-next-active');

            } else {
                // ì´ì „ë‹¬: ì™¼ìª½ì—ì„œ ë“¤ì–´ì˜´
                newGrid.classList.add('slide-prev-enter');
                wrapper.appendChild(newGrid);
                
                void newGrid.offsetWidth;

                currentGrid.classList.remove('slide-next-active'); // or prev-active
                currentGrid.classList.add('slide-prev-leave');

                newGrid.classList.remove('slide-prev-enter');
                newGrid.classList.add('slide-prev-active');
            }

            // ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ í›„ ì •ë¦¬
            setTimeout(() => {
                currentGrid.remove();
                // í´ë˜ìŠ¤ ì •ë¦¬ (ë‹¤ìŒ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ í‘œì¤€ ìƒíƒœë¡œ)
                newGrid.className = 'calendar-grid slide-next-active';
                isAnimating = false;
            }, 300);
        }

        function goToday() {
            currentDate = new Date();
            selectedDate = new Date();
            const wrapper = document.getElementById('calendarWrapper');
            wrapper.innerHTML = '';
            renderCurrentMonthGrid(wrapper);
            updateHeader();
            updateScheduleList();
        }

        // ================= ì¼ì • ë° ëª¨ë‹¬ ë¡œì§ =================
        function updateScheduleList() {
            const m = selectedDate.getMonth() + 1;
            const d = selectedDate.getDate();
            const dayName = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][selectedDate.getDay()];
            const fullDate = `${selectedDate.getFullYear()}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;

            document.getElementById('scheduleHeader').innerText = `${m}ì›” ${d}ì¼ (${dayName})`;
            document.getElementById('floatingBtnText').innerText = `${m}ì›” ${d}ì¼ì— ì¼ì • ì¶”ê°€`;

            // ëª¨ë‹¬ ì‹œê°„ ì´ˆê¸°ê°’ ì„¤ì • (ì„ íƒ ë‚ ì§œì˜ í˜„ì¬ ì‹œê°„)
            const now = new Date();
            const sTime = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), selectedDate.getDate(), now.getHours(), 0); // ì •ê°
            const eTime = new Date(sTime.getTime() + 60*60*1000); // 1ì‹œê°„ ë’¤

            // datetime-local format: YYYY-MM-DDTHH:mm
            const toLocalISO = (date) => {
                const offset = date.getTimezoneOffset() * 60000;
                return new Date(date.getTime() - offset).toISOString().slice(0, 16);
            };
            document.getElementById('startTimeInput').value = toLocalISO(sTime);
            document.getElementById('endTimeInput').value = toLocalISO(eTime);

            // ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
            const container = document.getElementById('scheduleContainer');
            container.innerHTML = '';
            
            const events = userEvents[fullDate] || [];
            // ê³µíœ´ì¼ ì²´í¬
            const mdKey = `${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const holiday = holidays.fixed[mdKey] || holidays.lunar[fullDate];

            if(holiday) {
                container.innerHTML += `
                    <div class="schedule-item">
                        <div class="schedule-color-bar" style="background:#FF6B6B"></div>
                        <div class="schedule-info">
                            <div class="schedule-title" style="color:#D32F2F">${holiday}</div>
                            <div class="schedule-time">ê³µíœ´ì¼</div>
                        </div>
                    </div>`;
            }

            if(events.length === 0 && !holiday) {
                container.innerHTML = `<div class="empty-message">ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</div>`;
            } else {
                events.forEach(evt => {
                    let timeStr = "í•˜ë£¨ ì¢…ì¼";
                    if(!evt.isAllDay) {
                        const s = new Date(evt.start);
                        const e = new Date(evt.end);
                        timeStr = `${s.getHours()}:${String(s.getMinutes()).padStart(2,'0')} - ${e.getHours()}:${String(e.getMinutes()).padStart(2,'0')}`;
                    }
                    if(evt.alarm && evt.alarm !== 'none') {
                        timeStr += ` ğŸ”” ${evt.alarm}ë¶„ ì „`;
                    }

                    container.innerHTML += `
                        <div class="schedule-item">
                            <div class="schedule-color-bar" style="background:${evt.color}"></div>
                            <div class="schedule-info">
                                <div class="schedule-title">${evt.title}</div>
                                <div class="schedule-time">${timeStr}</div>
                            </div>
                        </div>`;
                });
            }
        }

        // ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
        function openModal() {
            document.getElementById('eventModal').classList.add('open');
            document.getElementById('inputTitle').focus();
        }
        function closeModal() {
            document.getElementById('eventModal').classList.remove('open');
            setTimeout(() => {
                document.getElementById('inputTitle').value = '';
                // í† ê¸€ ë¦¬ì…‹
                document.getElementById('allDayToggle').classList.remove('active');
                document.getElementById('timePickerArea').classList.remove('disabled');
                document.getElementById('alarmSelect').value = '10';
            }, 300);
        }

        // í•˜ë£¨ì¢…ì¼ í† ê¸€
        function toggleAllDay() {
            const toggle = document.getElementById('allDayToggle');
            const timeArea = document.getElementById('timePickerArea');
            toggle.classList.toggle('active');
            
            if(toggle.classList.contains('active')) {
                timeArea.classList.add('disabled');
                // input disable ì²˜ë¦¬ë„ í•˜ë©´ ì¢‹ìŒ
                document.getElementById('startTimeInput').disabled = true;
                document.getElementById('endTimeInput').disabled = true;
            } else {
                timeArea.classList.remove('disabled');
                document.getElementById('startTimeInput').disabled = false;
                document.getElementById('endTimeInput').disabled = false;
            }
        }

        // ì €ì¥
        function saveEvent() {
            const title = document.getElementById('inputTitle').value.trim() || 'ìƒˆë¡œìš´ ì¼ì •';
            const isAllDay = document.getElementById('allDayToggle').classList.contains('active');
            const start = document.getElementById('startTimeInput').value;
            const end = document.getElementById('endTimeInput').value;
            const alarm = document.getElementById('alarmSelect').value;
            
            // ìƒ‰ìƒ ëœë¤
            const colors = ['#7986CB', '#64B5F6', '#4DB6AC', '#FFB74D', '#E57373', '#BA68C8'];
            const color = colors[Math.floor(Math.random() * colors.length)];

            const key = `${selectedDate.getFullYear()}-${String(selectedDate.getMonth()+1).padStart(2,'0')}-${String(selectedDate.getDate()).padStart(2,'0')}`;
            
            if(!userEvents[key]) userEvents[key] = [];
            userEvents[key].push({
                title, isAllDay, start, end, alarm, color
            });

            localStorage.setItem('myCalendarEventsPro', JSON.stringify(userEvents));
            
            // í™”ë©´ ê°±ì‹ 
            const wrapper = document.getElementById('calendarWrapper');
            wrapper.innerHTML = '';
            renderCurrentMonthGrid(wrapper); // ë±ƒì§€ ê°±ì‹  ìœ„í•´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            updateScheduleList();
            closeModal();
        }

        // ì‹œì‘
        init();

    </script>
</body>
</html>
